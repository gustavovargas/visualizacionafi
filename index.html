<!DOCTYPE html>
<html>
  <head>
    <title>Visualización AFI</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"> 

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="shortcut icon" type="image/x-icon"  href="https://raw.githubusercontent.com/gustavovargas/visualizacionafi/master/images/logoAFI.ico">

	 <script type="text/javascript" src="https://d3js.org/d3.v5.js"></script>
    <!--   <script type="text/javascript" src="js/d3/d3.min.js"></script>--> 
  </head>

  <style>
    body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif;}
    body, html {
      height: 100%;
      color: #777;
      line-height: 1.8;
    }
    a {text-decoration: none;}

    /*Efector Parallax */
    .bgimg-1, .bgimg-2, .bgimg-3 {
      background-attachment: fixed;
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
    }

    /* Primera imagen / PORTADA      OJO difuminar más con photoshop antes de enviarlo*/
    .bgimg-1 {
      background-image: url('images/portada.png');
      min-height: 100%;
    }

    /* Segunda imagen */
    .bgimg-2 {
      background-image: url("images/niños.jpg");
      min-height: 400px;
    }

    /* Tercera imagen */
    .bgimg-3 {
      background-image: url("images/soldiers.jpg");
      min-height: 400px;
    }

    .w3-wide {letter-spacing: 10px;}
    .w3-hover-opacity {cursor: pointer;}

    /* quitamos el efector parallax en móviles y tablets */
    @media only screen and (max-device-width: 1600px) {
    .bgimg-1, .bgimg-2, .bgimg-3 {
      background-attachment: scroll;
      min-height: 400px;
      }
    }

    /*Estilo para el tooltip del mapa*/
    #tooltip{
      padding: .5em;
      position: absolute;
      display: none;
      background-color: white; 
      opacity: 0.9; 
      text-shadow: #f5f5f5 0 1px 0;
      border-radius: 2px; 
      box-shadow: 0px 0px 2px 0px #a6a6a6;
    }
  </style>

<body>

  <!-- Basado en el template de https://www.w3schools.com/w3css/tryw3css_templates_parallax.htm#portfolio-->

  <!-- BARRA DEL NAVEGADOR DE ARRIBA -->
  <div class="w3-top">
    <div class="w3-bar" id="myNavbar">
      <a class="w3-bar-item w3-button w3-hover-black w3-hide-medium w3-hide-large w3-right" href="javascript:void(0);" onclick="toggleFunction()" title="Toggle Navigation Menu">
        <i class="fa fa-bars"></i>
      </a>
      <a href="#inicio" class="w3-bar-item w3-button">INICIO</a>
      <a href="#historia" class="w3-bar-item w3-button w3-hide-small">HISTORIA</a>
      <a href="#conclusiones" class="w3-bar-item w3-button w3-hide-small">CONCLUSIONES</a>
      <a href="#bibliografia" class="w3-bar-item w3-button w3-hide-small">BIBLIOGRAFÍA</a>
      <a href="#autor" class="w3-bar-item w3-button w3-hide-small">AUTOR</a>
      <a href="http://www.afiescueladefinanzas.es" class="w3-bar-item w3-button w3-hide-small w3-right w3-hover-red"><b>AFI Escuela de Finanzas</b></a>
      </a>
    </div>

    <!-- Barra del navegador en ventanas pequeñas -->
    <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium">
      <a href="#historia" class="w3-bar-item w3-button" onclick="toggleFunction()">HISTORIA</a>
      <a href="#conclusiones" class="w3-bar-item w3-button" onclick="toggleFunction()">CONCLUSIONES</a>
      <a href="#autor" class="w3-bar-item w3-button" onclick="toggleFunction()">AUTOR</a>
    </div>
  </div>

  <!-- CABECERO -->
  <div class="bgimg-1 w3-display-container w3-opacity-min" id="inicio" align="center">
    <div class="w3-display-middle" style="white-space:nowrap;"> <span class="w3-center w3-padding-large w3-wide w3-xxlarge w3-animate-opacity">práctica de datos abiertos y visualización </span> <br>
      <span class="w3-center w3-padding-large w3-black w3-xlarge w3-wide w3-animate-opacity">
      <span class="w3-hide-small">ANARQUÍA EN</span>   SOMALIA</span>
    </div>
  </div>


  <!-- CONTAINER DE Breve historia de Somalia -->
  <div class="w3-content w3-container w3-padding-64" id="historia">
    <h3 class="w3-center">BREVE HISTORIA DE SOMALIA</h3>
    <p class="w3-center"><em>Somalia estuvo sin gobierno desde la caída del dictador Siad Barre el 26 de Enero de 1991 hasta la formación de un nuevo gobierno en 2012. ¿Qué consecuencias podemos extraer de 20 años de inestabilidad?</em></p>
    <p>Somalia es un pequeño país del cuerno de África, con aproximadamente unos 11 millones de habitantes. Sin embargo, no ha sido nunca un país tranquilo. Después de la Segunda Guerra Mundial, los protectorados italianos y británicos se unieron y proclamaron su independencia en 1960, formando un país democrático. Sin embargo, ocho años después, el presidente sería asesinado y tomaría su lugar el dictador Mohamed Siad Barre. El gobierno de Barre buscaba armonizar el marxismo e islamismo, por lo que tuvo el apoyo de la URSS. Sin embargo, Barre decidió a conquistar al vecino Etiopía, y eso hizo que los soviéticos se pusiesen en su contra. Repelido el ataque, el gobierno de Barre quedó fuertemente tocado. Fuertes disturbios entre clanes y el surgimiento de numerosos movimientos que buscaban, por la fuerza, acabar con la dictadura, hicieron que en 1991 acabase el gobierno de Barre, pero tampoco permitió la formación de un nuevo Estado. Los años 90 se caracterizaron por continuas disputas violentas entre aquellos grupos. Esto llevo a un hambre generalizado, y la ONU y EEUU intervinieron antes de que fuese a peor. En 2006 la <a href="https://es.wikipedia.org/wiki/Uni%C3%B3n_de_Tribunales_Isl%C3%A1micos" target="_blank">Unión de Tribunales Islámicos</a>  tomó el control de la capital, Mogadishu.
    Entonces Etiopía, con el apoyo de Estado Unidos, decidió invadir el país para anular a los islamistas, pero nunca llegó a tomar el control total, reproduciéndose una y otra vez continuas batallas en las calles. Más de un millón y medio de personas del sur del país, especialmente de zonas cercanas a la capital, huyeron como refugiados a otros países 
     </p>
  </div>
  
  <div id="tooltip">Tooltip</div>

  <!-- MAPA SOMALIA -->
  <div class="w3-center w3-padding-large">
  	<svg id="container" width="400px" height="400px">
      <g id="mapasomalia" style="transform:translate(-1170px,160px)">      
      </g>
      <g id="textosomalia">      
      </g>
  	</svg>
  </div>

  <div class="w3-content">
    <p>El norte, en cambio, ha tenido una relativa paz, especialmente la zona que antes era británica, Somaliland. En 1991, al caer Barre, se proclamaron independientes, aunque su independencia ha sido internacionalmente reconocida. A pesar de ello, en 2010 tuvieron sus primeras elecciones y una transferencia pacífica de poder, algo raro en África.

    Al lado de Somaliland tenemos la región de de Puntland, que si bien no quiere la independencia, también formó un gobierno paralelo. Esta región está tomada por piratas, que han sido conocidos por secuestrar y extorsionar barcos que pasaban a oriente medio.</p>
    
    <p>A pesar de todo esto, y aunque parezca increíble, el nivel de vida ha ido aumentando lentamente. Es verdad que Somalia sigue siendo uno de los países más pobres de África, pero su población se las ha ingeniado para sobrevivir sin un Estado. El PIB de Somalia y la esperanza de vida han crecido de manera sostenida en estos últimos veinte años, y su gente supo frenar el avance de epidemias como el sida, cosa que países vecinos, con sus Estados, no supieron hacer frente. Esta mejora, en parte, también se debe a las ayudas prestadas por agencias internacionales.</p>

    <h4>Piratas</h4>
    <p>Sin nadie que aplique la ley, y con escasas opciones de vida, muchos jóvenes somalíes han decidido volverse piratas, ganando varios millones de dólare por cada barco secuestrado. Distintos países y entidades internacionales han enviado barcos patrulla para evitar dichos asaltos, pero los piratas somalíes han respondido ampliando sus fuerzas y su territorio a saquear, asaltando barcos más cerca de India que del cuerno de África</p>
    </div>
  </div>

  <!-- BARRA HORIZONTAL con números dentro -->
  <div class="w3-row w3-center w3-dark-grey w3-padding-16">
    <div class="w3-quarter w3-section">
      <span class="w3-xlarge">+20</span><br>
      años en anarquía
    </div>
    <div class="w3-quarter w3-section">
      <span class="w3-xlarge">+14</span><br>
      Provincias
    </div>
    <div class="w3-quarter w3-section">
      <span class="w3-xlarge">+15</span><br>
      presidentes fallidos
    </div>
    <div class="w3-quarter w3-section">
      <span class="w3-xlarge">150+</span><br>
      Meetings
    </div>
  </div>

  <!-- Imagen de los niños con Conclusiones encima -->
  <div class="bgimg-2 w3-display-container w3-opacity-min">
    <div class="w3-display-middle">
      <span class="w3-xxlarge w3-text-white w3-wide">CONCLUSIONES</span>
    </div>
  </div>

  <!-- CONTAINER DE CONCLUSIONES Y LINECHART-->
  <div class="w3-content w3-container w3-padding-64" id="conclusiones">
    <h3 class="w3-center">¿FUE BUENA LA ANARQUÍA?</h3>
    <p class="w3-center"><em>Con estos ocho indicadores intentaremos entender cómo evolucióno la vida en esta zona del cuerno de África.<br> Haz click en los diferentes indicadores para verlos </em></p><br>

    <!-- BOTONES -->
    <div class="w3-center">
      <button class="w3-button" id="bot_poblacion">Población</button>
      <button class="w3-button w3-light-grey" id="bot_mortalidad">Mortalidad</button>
      <button class="w3-button" id="bot_esperanza_vida">Esperanza de vida</button>
      <button class="w3-button w3-light-grey" id="bot_fertilidad">Fertilidad</button> <br>
      <button class="w3-button w3-light-grey" id="bot_ados_fertilidad">Fertilidad en adolescentes</button>
      <button class="w3-button" id="bot_sida">VIH</button>
      <button class="w3-button w3-light-grey" id="bot_forestal">Área forestal</button><br>
      <button class="w3-button w3-light-grey" id="bot_movil">Acceso a telefonía móvil</button> 
      <button class="w3-button" id="bot_inversion">Inversión extranjera</button>
      <button class="w3-button w3-light-grey" id="bot_ayudas">Ayuda externa</button>
    </div>

    <!-- linechart -->
    <div class="w3-center w3-padding-large">
      <svg id="svg2" height="350" width="600">
        <g id="linechart" style="transform:translate(80px,60px)"></g>
        <g id="xAxis"></g>
        <g id="yAxis"></g>
        <div class="legend3"></div>
      </svg>
      <div id="#leyenda" class="legend4">
      </div>
    </div>

    <div class="w3-content">
      <p>Hemos comparado aquí a Somalia con sus dos países vecinos más importantes, Etiopía y Kenia, a pesar de que parten de puntos distintos en cuanto a desarrollo humano. Además, estos son los datos disponibles en el Banco Mundial, otros datos muy interesantes, como el PIB, desempleo, <i>doing business</i>, etc. no se han recogido por la propia situación del Estado somalí. Aún así, con estos datos podemos ver que, si bien Somalia no va mejor que sus vecinos, tampoco va tan mal como pensaríamos que iría un estado fallido. Al contrario, el rendimiento de Somalia es incluso superior en ciertas variables. De ahí que podamos poner en tela de juicio la idea de que el Estado es siempre un motor de crecimiento, entiendo que, de formarse un Estado en Somalia, no tendría una mejor calidad institucional que la de sus vecinos.</p>
    </div>

  </div>


  <!-- CONTAINER DE BIBLIOGRAFÍA -->
  <div class="w3-content w3-container w3-padding-64" id="bibliografia">
    <h3 class="w3-center">BIBLIOGRAFÍA</h3>
      <p class="w3-content"><i class="fa fa-newspaper-o"></i> <a href="https://www.bbc.com/news/world-africa-12285365" target="_blank"">Editorial (2011). Somalia: Counting the cost of anarchy. <i>BBC News</i>.</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=1676428#" target="_blank"">Farley, Benjamin R. (2010). Calling a State a State:Somaliland and International Recognition. <i>Emory International Law Review</i>, Vol. 24, No. 2.</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=1801563" target="_blank"">Luther, W. & White, L. Positively Valued Fiat Money after the Sovereign Disappears: The Case of Somalia. <i>GMU Working Paper in Economics</i> No. 11-14</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="http://documents.worldbank.org/curated/en/975231536256355812/pdf/REPLACEMENT-PUBLIC-Somalia-Economic-Update-3-FINAL.pdf" target="_blank"">World Bank Document (August 2018). Somalia Economic Update.</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://landinfo.no/wp-content/uploads/2018/06/Report-Somalia-Security-challenges-in-Mogadishu-May-2018-1.pdf" target="_blank"">Landinfo (May 2018). Somalia: Security challenges in Mogadishu.</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://www.belfercenter.org/sites/default/files/legacy/files/is3103_pp074-106_menkhaus.pdf" target="_blank"">Menkhaus, K. (2006) Governance without Government in Somalia. <i>International Security</i>, Vol. 31, No. 3, pp. 74-106</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://www.orfonline.org/research/somalia-a-failed-state/" target="_blank"">Venugopalan, H. (February 2017). Somalia: A failed state?. <i>ORF Issue Brief</i>. Issue No. 170</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://www.orfonline.org/research/somalia-a-failed-state/" target="_blank"">Powell, B. (2008). Somalia after State Collapse: chaos or improvement?. <i>Journal of economic behaviour & organization</i>. No. 67, pp 657–670</a></p>

      <p class="w3-content"><i class="fa fa-book"></i> <a href="https://www.orfonline.org/research/somalia-a-failed-state/" target="_blank"">Coyne, C. & Leeson, P. (2010). Somalia: Understanding feasible institutions. En <i>Somalia: Economic, Political and Social Issues</i> (Nova Publishers), Elias P. Hoffmann ed., pp. 61-67.</a></p>
    
  </div>

  <!-- Tercer Parallax antes del autor -->
  <div class="bgimg-3 w3-display-container w3-opacity-min">
    <div class="w3-display-middle">
       <span class="w3-xxlarge w3-text-white w3-wide">AUTOR</span>
    </div>
  </div>

  <!-- Container del autor -->
  <div class="w3-content w3-container w3-padding-64" id="autor">
    <h3 class="w3-center">GUSTAVO VARGAS</h3>
    <p class="w3-center"><em>Estudiante del máster en Data Science y Big Data Finanzas de AFI <br>Práctica de visualización y datos abiertos</em></p>
    <div class="w3-row w3-section">
      <div class="w3-col m4 w3-container w3-hover-opacity w3-animate-opacity">
        <img src="images/careto.png" class="w3-image w3-round" style="width:100%">
      </div>
      <div class="w3-col m8 w3-panel">
        <div class="w3-large w3-margin-bottom">
          <i class="fa fa-map-marker fa-fw w3-hover-text-black w3-xlarge w3-margin-right"></i> Madrid, ES<br>
          <i class="fa fa-phone fa-fw w3-hover-text-black w3-xlarge w3-margin-right"></i> Teléfono: +34 633 316 474<br>
          <i class="fa fa-envelope fa-fw w3-hover-text-black w3-xlarge w3-margin-right"></i> Email: ge.vargasn@gmail.com<br>
        </div>
      </div>
    </div>
  </div>



  <!-- Pié de página -->
  <footer class="w3-center w3-black w3-padding-64 w3-opacity w3-hover-opacity-off">
    <a href="#inicio" class="w3-button w3-light-grey"><i class="fa fa-arrow-up w3-margin-right"></i>Volver al inicio</a>
    <div class="w3-xlarge w3-section">
      <a href="https://www.facebook.com/ge.vargasn" class="fa fa-facebook-official w3-hover-opacity" target="_blank"></a>
      <a href="https://www.instagram.com/gvarnu/" class="fa fa-instagram w3-hover-opacity" target="_blank"></a>
      <a href= "https://twitter.com/gvarnu" class="fa fa-twitter w3-hover-opacity" target="_blank"></a>
      <a href="https://www.linkedin.com/in/gustavovargas2/" class="fa fa-linkedin w3-hover-opacity" target="_blank"></a>
    </div>
    <p>Plantilla base de <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-text-green">w3.css</a></p>
  </footer>
   
  <script>
  // Función que hace que cambie el fondo de la barra de navegación del cabecero
  window.onscroll = function() {myFunction()};
  function myFunction() {
      var navbar = document.getElementById("myNavbar");
      if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
          navbar.className = "w3-bar" + " w3-card" + " w3-animate-top" + " w3-white";
      } else {
          navbar.className = navbar.className.replace(" w3-card w3-animate-top w3-white", "");
      }
  }

  // Es la función que hace que la barra de navegación del cabecero que sale en ventanas pequeñas. No hace bien lo del responsive MEJORAR
  function toggleFunction() {
      var x = document.getElementById("navDemo");
      if (x.className.indexOf("w3-show") == -1) {
          x.className += " w3-show";
      } else {
          x.className = x.className.replace(" w3-show", "");
      }
  }
  </script>


 <script type="text/javascript">
	let mapa = d3.select("#mapasomalia")
	d3.json("json/somalia4.geojson").then(showData)

  function showTooltip(text,coords){  // función para el tooltip
    d3.select("#tooltip").text(text)
      .style("top",coords[1]+"px")
      .style("left",coords[0]+10+"px")
      .style("display","block")
  }

	function showData(mapInfo){
		let bodyHeight = 350
		let bodyWidth = 350

		let projection = d3.geoMercator()  // probar geoNaturalEarth1() por si queda mejor
			.scale(1500)
			.translate([bodyWidth/2,bodyHeight/2])

		let path = d3.geoPath()
			.projection(projection)

		mapa.selectAll("path")
			.data(mapInfo.features)
			.enter()
			.append("path")
			.attr("d",d=>path(d))
			.attr("stroke","#999")
			.attr("fill","#eee")
      .on("mouseenter",function(){  // para que se coloree cada feature del d3
        this.style.fill = "#989898"
      })
      .on("mouseout",function(){
        this.style.fill="#eee"
      })
      .on("mousemove", d=>{
        showTooltip(d.id, [d3.event.pageX, d3.event.pageY]) // tiene que ser event.page, porque con event.client no reconoce bien las coordenadas, porque las del svg y body no son las mismas
      })
      .on("mouseleave", d=>{
        d3.select("#tooltip").style("display","none")
      })

    mapa.select("#textosomalia")
        .append("text")
        .attr("class","texto")
        .attr("x","100")
        .attr("y","100")
        .text("Somaliaqwe")
        .attr("font-size","40px")
	}
  </script>


  <script>
    let linechart = d3.select("#linechart")
    let valor = "mortalidad"

    let bodyHeight = 200
    let bodyWidth = 400

    let titulo = "Mortalidad"
    let subtitulo = "Fallecidos menores de cinco años por cada mil nacidos vivos"

    d3.csv("data/data.csv").then((data)=>{
      showChart(data,valor,titulo,subtitulo)

      d3.select("#bot_poblacion").on("click",function(){
        let valor = "poblacion"
        let titulo = "Población"
        let subtitulo = "Habitantes de un país. Millones de personas"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_mortalidad").on("click",function(){
        let valor = "mortalidad"
        let titulo = "Mortalidad"
        let subtitulo = "Fallecidos menores de cinco años por cada mil nacidos vivos"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_esperanza_vida").on("click",function(){
        let valor = "esperanza_vida"
        let titulo = "Esperanza de vida"
        let subtitulo = "Media de años que espera vivir un niño al nacer"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_fertilidad").on("click",function(){
        let valor = "fertilidad"
        let titulo = "Tasa de fertilidad"
        let subtitulo = "Número de nacimiento por cada mil mujeres"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_ados_fertilidad").on("click",function(){
        let valor = "ados_fertilidad"
        let titulo = "Tasa de fertilidad en adolescentes"
        let subtitulo = "Número de nacimientos por 1000 mujeres entre 15 y 19 años"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_sida").on("click",function(){
        let valor = "sida"
        let titulo = "Tasa de enfermos por VIH"
        let subtitulo = "Seropositivos como porcentaje de la población entre 15 y 49 años"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_forestal").on("click",function(){
        let valor = "forestal"
        let titulo = "Área forestal"
        let subtitulo = "Kilómetros cuadrados"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_movil").on("click",function(){
        let valor = "movil"
        let titulo = "Uso de telefonía móvil"
        let subtitulo = "Abonados a tarifa móvil por cada 100 personas"
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_inversion").on("click",function(){
        let valor = "inversion"
        let titulo = "Inversión extranjera directa neta"
        let subtitulo = "Millones de dólares. Dólares corrientes."
        showChart(data,valor,titulo,subtitulo)
      })

      d3.select("#bot_ayudas").on("click",function(){
        let valor = "ayudas"
        let titulo = "Ayuda externa"
        let subtitulo = "Ayudas al desarrollo. Millones de dólares. Dólares corrientes."
        showChart(data,valor,titulo,subtitulo)
      })
    })


    function showChart(data,valor,titulo,subtitulo){
      
      data = data.map(d => ({
        pais: d.pais,
        ano: +d.ano,
        value: +d[valor]
      }))

      data_som = data.filter(function(d){return d.pais == "Somalia";})
      data_eti = data.filter(function(d){return d.pais == "Ethiopia";})      
      data_ken = data.filter(function(d){return d.pais == "Kenya";})

      let maxValue = d3.max(data,d=>+d.value)
      let minValue = d3.min(data,d=>+d.value)

      // EJES
      let yScale = d3.scaleLinear()
        .range([bodyHeight,0])
        .domain([minValue,maxValue]);
      
      let xScale = d3.scaleLinear()
        .range([0,bodyWidth])
        .domain(d3.extent(data,d=>d.ano));

      let yAxis = d3.axisLeft(yScale)
        .ticks(4)
        .tickFormat(d3.format(""))

      yAxisContainer = d3.select("#yAxis")
        .style("transform","translate(80px,60px)")
        .transition()
        .call(yAxis)

      let xAxis = d3.axisBottom(xScale)
        .tickFormat(d3.format(""))

      xAxisContainer = d3.select("#xAxis")
        .attr("transform","translate(80, "+(bodyHeight+60)+")")
        .transition()
        .call(xAxis)
        .selectAll("text")
        .attr("transform", "translate(-7,8) rotate(-35)")


      //LÍNEAS
      valueline = d3.line()
        .x(d => xScale(d.ano))
        .y(d => yScale(+d.value))
        .defined(d=> !!+d.value)

      linechart.selectAll("path").transition().remove()

      linechart.append("path")
        .datum(data_som)
        .attr("d",valueline)
        .attr("class","line")
        .attr("fill", "none")
        .attr("stroke", "#619cff")
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("stroke-linecap", "round")

      linechart.append("path")
        .datum(data_eti)
        .attr("d",valueline)
        .attr("class","line")
        .attr("fill", "none")
        .attr("stroke", "#f8766d")
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("stroke-linecap", "round")

      linechart.append("path")
        .datum(data_ken)
        .attr("d",valueline)
        .attr("class","line")
        .attr("fill", "none")
        .attr("stroke", "#00ba38")
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("stroke-linecap", "round")
        .attr("data-legend","Kenia")


      let join_dot_som = linechart.selectAll("circle")
        .data(data_som)

      let new_dot_som = join_dot_som.enter()
        .append("circle")
        .attr("class","dot")
        .attr("fill", "#619cff")
        .attr("stroke", "#619cff")
        .attr("r",3.5)

      join_dot_som.merge(new_dot_som).transition()
        .attr("cx", function(d){ return xScale(d.ano)})
        .attr("cy", function(d){ return yScale(d.value)})

      join_dot_som.exit().transition().remove()



      let join_dot_eti = linechart.selectAll("dot")
        .data(data_eti)

      let new_dot_eti =join_dot_eti.enter()
        .append("circle")
        .attr("class","dot")
        .attr("fill", "#f8766d")
        .attr("stroke", "#f8766d")
        .attr("r",3.5)

      join_dot_eti.merge(new_dot_eti).transition()
        .attr("cx", function(d){ return xScale(d.ano)})
        .attr("cy", function(d){ return yScale(d.value)})

      join_dot_eti.exit().transition().remove()



      let join_dot_ken = linechart.selectAll("dotken")
        .data(data_ken)

      let new_dot_ken =join_dot_ken.enter()
        .append("circle")
        .attr("class","dot")
        .attr("fill", "#00ba38")
        .attr("stroke", "#00ba38")
        .attr("r",3.5)

      join_dot_ken.merge(new_dot_ken).transition()
        .attr("cx", function(d){ return xScale(d.ano)})
        .attr("cy", function(d){ return yScale(d.value)})

      join_dot_ken.exit().transition().remove()


      // LEYENDA DEL LINECHART
      
      legendVals = d3.set(data.map( function(d) { return d.pais } ) ).values()
      var color = d3.scaleOrdinal(d3.schemeCategory10)

      var legendVals1 = d3.scaleOrdinal()
        .domain(legendVals)
        .range(["#619cff", "#f8766d", "#00ba38"]);

      var svgLegned3 = d3.select('#linechart').append("svg")
        .attr("width", d3.select("#svg2").attr("width"))
        .attr("height", d3.select("#svg2").attr("height"))
        .attr("transform", "translate(0,10)")

      var legend3 = svgLegned3.selectAll('.legend3')
        .data(legendVals1.domain())
        .enter().append('g')
        .attr("class", "legends3")
        .attr("transform", function (d, i) {
            {
            return "translate(430," + (i * 20 + 70) + ")"
            }
        })
        
      legend3.append('rect')
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", 10)
        .attr("height", 10)
        .style("fill", function (d, i) {
            lista = ["#619cff", "#f8766d", "#00ba38"]
            return lista[i]
        })
      
      legend3.append('text')
        .attr("x", 20)
        .attr("y", 10)
        .text(function (d, i) {
            return d
        })
        .attr("class", "textselected")
        .style("text-anchor", "start")
        .style("font-size", 10)

      svgLegned3.select("g")
        .append("text")
        .attr("x","0")
        .attr("y","-10")
        .text("País")
        .attr("font-size","12px")


      // TITULO DEL LINECHART, EJES Y PIE

      var svgTitulo = d3.select('#svg2').append("svg")
        .attr("width", d3.select("#svg2").attr("width"))
        .attr("height", d3.select("#svg2").attr("height"))
        .attr("transform", "translate(0,10)")

      d3.selectAll(".texto").remove()

      svgTitulo.append("g")
        .append("text")
        .attr("class","texto")
        .attr("x","80")
        .attr("y","25")
        .text(titulo)
        .attr("font-size","20px")

      svgTitulo.append("g")
        .append("text")
        .attr("class","texto")
        .attr("x","80")
        .attr("y","50")
        .text(subtitulo)
        .attr("font-size","15px")

      svgTitulo.append("g")
        .append("text")
        .attr("class","texto")
        .attr("x","355")
        .attr("y","330")
        .text("Fuente: World Bank Data")
        .attr("font-size","12px")

      svgTitulo.append("g")
        .append("text")
        .attr("class","texto")
        .attr("x","30")
        .attr("y","190")
        .text(titulo)
        .attr("font-size","13px")
        .attr("transform","translate(-160,260) rotate(-90)")

      svgTitulo.append("g")
        .append("text")
        .attr("class","texto")
        .attr("x","280")
        .attr("y","310")
        .text("año")
        .attr("font-size","13px")
    }

  </script>
</body>
</html>
